[gd_scene load_steps=21 format=3 uid="uid://dousinkic130u"]

[ext_resource type="Script" uid="uid://br8ltumy454oj" path="res://Engine/Cylinder/Cylinder.cs" id="1_nxogm"]
[ext_resource type="Script" uid="uid://b7ba3uaxjle7" path="res://Engine/Crankshaft.cs" id="2_3253y"]
[ext_resource type="PackedScene" uid="uid://yr1lm7flecqr" path="res://Engine/crank_pin_new.tscn" id="2_u3cyc"]
[ext_resource type="Script" uid="uid://c851y26dq0p8q" path="res://Engine/Charts.cs" id="3_xlvrw"]
[ext_resource type="Script" uid="uid://uqcqw4fkolyo" path="res://Engine/Cylinder/CylinderVisuals.cs" id="4_m7jmp"]
[ext_resource type="Shader" uid="uid://d2po6ur3ne678" path="res://GassVisualization.gdshader" id="4_u3cyc"]
[ext_resource type="Script" uid="uid://0ahy3760o3gk" path="res://Engine/Cylinder/AirFlow.cs" id="4_y2354"]
[ext_resource type="PackedScene" uid="uid://dsg5g4ti0n3gt" path="res://Sounds/soundscene.tscn" id="7_ni31j"]
[ext_resource type="PackedScene" uid="uid://jk53mwq3nqag" path="res://chart_point.tscn" id="8_73fnb"]
[ext_resource type="Script" uid="uid://c38ac4trq2i3u" path="res://Chassis/ChassisMain.cs" id="9_5juve"]

[sub_resource type="CylinderMesh" id="CylinderMesh_u3cyc"]
top_radius = 1.0
bottom_radius = 1.0
height = 1.0

[sub_resource type="CylinderMesh" id="CylinderMesh_nxogm"]
top_radius = 1.0
bottom_radius = 1.0
height = 1.0

[sub_resource type="ShaderMaterial" id="ShaderMaterial_y2354"]
render_priority = 0
shader = ExtResource("4_u3cyc")
shader_parameter/pressure = 0.0
shader_parameter/minPressure = 0.0
shader_parameter/maxPressure = 0.0

[sub_resource type="Gradient" id="Gradient_y2354"]
interpolation_mode = 2
interpolation_color_space = 2
offsets = PackedFloat32Array(0, 0.5, 1)
colors = PackedColorArray(0, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1)

[sub_resource type="GradientTexture1D" id="GradientTexture1D_ni31j"]
gradient = SubResource("Gradient_y2354")
width = 500

[sub_resource type="ShaderMaterial" id="ShaderMaterial_5juve"]
render_priority = 0
shader = ExtResource("4_u3cyc")
shader_parameter/pressureSampler = SubResource("GradientTexture1D_ni31j")
shader_parameter/pressure = 0.0
shader_parameter/minPressure = -100000.0
shader_parameter/maxPressure = 999999.0

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ni31j"]
render_priority = 0
shader = ExtResource("4_u3cyc")
shader_parameter/pressureSampler = SubResource("GradientTexture1D_ni31j")
shader_parameter/pressure = 0.0
shader_parameter/minPressure = -100000.0
shader_parameter/maxPressure = 999999.0

[sub_resource type="ShaderMaterial" id="ShaderMaterial_xlvrw"]
render_priority = 0
shader = ExtResource("4_u3cyc")
shader_parameter/pressureSampler = SubResource("GradientTexture1D_ni31j")
shader_parameter/pressure = 0.0
shader_parameter/minPressure = -100000.0
shader_parameter/maxPressure = 999999.0

[sub_resource type="ShaderMaterial" id="ShaderMaterial_73fnb"]
render_priority = 0
shader = ExtResource("4_u3cyc")
shader_parameter/pressureSampler = SubResource("GradientTexture1D_ni31j")
shader_parameter/pressure = 0.0
shader_parameter/minPressure = -100000.0
shader_parameter/maxPressure = 999999.0

[sub_resource type="Curve" id="Curve_5juve"]
_limits = [0.0, 1024.0, 0.0, 500.0]
bake_resolution = 1000
_data = [Vector2(0, 0), 0.0, 0.0, 0, 0, Vector2(500, 1024), 3.38618, 0.0, 0, 0]
point_count = 2

[node name="Scene" type="Node3D"]

[node name="crankShaft" type="Node3D" parent="." node_paths=PackedStringArray("mesh", "airFlow", "crankPinSpawnPoint", "soundController", "charts", "cylinders", "throttleSlider", "angularVelocityText", "pressureInsideCylinder1", "totalTorque", "rpm", "starterButton", "gameFps")]
script = ExtResource("2_3253y")
mesh = NodePath("crankShaftMesh")
airFlow = NodePath("Airflow")
crankPinSpawnPoint = NodePath("crankPinSpawnPoint")
crankPinPrefab = ExtResource("2_u3cyc")
soundController = NodePath("../Scene/Engine controller")
charts = NodePath("charts")
momentOfInertia = 3278.69
shaftAngleDeg = 414.126
angularVelocityDeg = 1000.0
crankshaftLength = 27.75
cylindersPadding = 4.87
cylinders = [NodePath("Cylinder"), NodePath("Cylinder2"), NodePath("Cylinder3"), NodePath("Cylinder4")]
rodLength = 8.475
crankPinLength = 3.025
throttleSlider = NodePath("throttle")
angularVelocityText = NodePath("angular velocity")
pressureInsideCylinder1 = NodePath("pressure")
totalTorque = NodePath("torque")
rpm = NodePath("rpm")
starterButton = NodePath("starter")
gameFps = NodePath("fps")
starterTorque = 9.50726e+06
mechanicalDragModifier = 804.2
pressureChangeFrictionModifier = 2.0
averageSmoothingFrames = 800

[node name="Airflow" type="Node" parent="crankShaft"]
script = ExtResource("4_y2354")
MaxValveLift = 10.0
throttleDiameter = 1.0
intakeVelocityModifier = 0.479
flowEfficiency = 0.458

[node name="crankPinSpawnPoint" type="Node3D" parent="crankShaft"]
transform = Transform3D(0.586005, -0.810308, 0, 0.810308, 0.586005, 0, 0, 0, 1, 0, 0, 0)
rotation_order = 0

[node name="crankShaftMesh" type="MeshInstance3D" parent="crankShaft"]
transform = Transform3D(0.586005, 0, 0.810308, 0.810308, -1.21299e-06, -0.586005, 3.54197e-08, 27.75, -2.56151e-08, 0, 0, 13.875)
rotation_order = 0
mesh = SubResource("CylinderMesh_u3cyc")

[node name="Cylinder" type="Node3D" parent="crankShaft" node_paths=PackedStringArray("visuals", "crankshaft")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 7.91675, 4.87)
script = ExtResource("1_nxogm")
visuals = NodePath("visuals")
crankshaft = NodePath("..")
pistonPosition = 0.549418
currentStrokeType = 3
boreDm = 1.0
strokeLength = 3.58325
additionalUpwardHeight = 0.2
pistonHeight = 1.0

[node name="pistone" type="MeshInstance3D" parent="crankShaft/Cylinder"]
transform = Transform3D(0.001, 0, 0, 0, 1, 0, 0, 0, 0.001, 0, 1.4687, 0)
mesh = SubResource("CylinderMesh_nxogm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("ShaderMaterial_y2354")

[node name="gas" type="MeshInstance3D" parent="crankShaft/Cylinder"]
transform = Transform3D(0.001, 0, 0, 0, 1.81455, 0, 0, 0, 0.001, 0, 2.87597, 0)
mesh = SubResource("CylinderMesh_nxogm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("ShaderMaterial_5juve")

[node name="visuals" type="Node3D" parent="crankShaft/Cylinder" node_paths=PackedStringArray("main", "gasInsideCylinder", "piston")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0366402, 0, 0)
script = ExtResource("4_m7jmp")
main = NodePath("..")
gasInsideCylinder = NodePath("../gas")
piston = NodePath("../pistone")

[node name="Cylinder2" type="Node3D" parent="crankShaft" node_paths=PackedStringArray("visuals", "crankshaft")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 7.91675, 10.8733)
script = ExtResource("1_nxogm")
visuals = NodePath("visuals")
crankshaft = NodePath("..")
cylinderIndex = 1
angleOffset = 180.0
pistonPosition = -0.440001
boreDm = 1.0
strokeLength = 3.58325
additionalUpwardHeight = 0.2
pistonHeight = 1.0

[node name="pistone" type="MeshInstance3D" parent="crankShaft/Cylinder2"]
transform = Transform3D(0.001, 0, 0, 0, 1, 0, 0, 0, 0.001, 0, -2.07663, 0)
mesh = SubResource("CylinderMesh_nxogm")
skeleton = NodePath("../../..")

[node name="gas" type="MeshInstance3D" parent="crankShaft/Cylinder2"]
transform = Transform3D(0.001, 0, 0, 0, 5.35988, 0, 0, 0, 0.001, 0, 1.10331, 0)
mesh = SubResource("CylinderMesh_nxogm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("ShaderMaterial_ni31j")

[node name="visuals" type="Node3D" parent="crankShaft/Cylinder2" node_paths=PackedStringArray("main", "gasInsideCylinder", "piston")]
script = ExtResource("4_m7jmp")
main = NodePath("..")
gasInsideCylinder = NodePath("../gas")
piston = NodePath("../pistone")

[node name="Cylinder3" type="Node3D" parent="crankShaft" node_paths=PackedStringArray("visuals", "crankshaft")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 7.91675, 16.8767)
script = ExtResource("1_nxogm")
visuals = NodePath("visuals")
crankshaft = NodePath("..")
cylinderIndex = 2
angleOffset = 540.0
pistonPosition = -0.440001
currentStrokeType = 2
boreDm = 1.0
strokeLength = 3.58325
additionalUpwardHeight = 0.2
pistonHeight = 1.0

[node name="pistone" type="MeshInstance3D" parent="crankShaft/Cylinder3"]
transform = Transform3D(0.001, 0, 0, 0, 1, 0, 0, 0, 0.001, 0, -2.07663, 0)
mesh = SubResource("CylinderMesh_nxogm")
skeleton = NodePath("../../..")

[node name="gas" type="MeshInstance3D" parent="crankShaft/Cylinder3"]
transform = Transform3D(0.001, 0, 0, 0, 5.35988, 0, 0, 0, 0.001, 0, 1.10331, 0)
mesh = SubResource("CylinderMesh_nxogm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("ShaderMaterial_xlvrw")

[node name="visuals" type="Node3D" parent="crankShaft/Cylinder3" node_paths=PackedStringArray("main", "gasInsideCylinder", "piston")]
script = ExtResource("4_m7jmp")
main = NodePath("..")
gasInsideCylinder = NodePath("../gas")
piston = NodePath("../pistone")

[node name="Cylinder4" type="Node3D" parent="crankShaft" node_paths=PackedStringArray("visuals", "crankshaft")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 7.91675, 22.88)
script = ExtResource("1_nxogm")
visuals = NodePath("visuals")
crankshaft = NodePath("..")
cylinderIndex = 3
angleOffset = 360.0
pistonPosition = 0.549418
currentStrokeType = 1
boreDm = 3.71
strokeLength = 3.58325
additionalUpwardHeight = 0.2
pistonHeight = 1.0

[node name="pistone" type="MeshInstance3D" parent="crankShaft/Cylinder4"]
transform = Transform3D(0.00371, 0, 0, 0, 1, 0, 0, 0, 0.00371, 0, 1.4687, 0)
mesh = SubResource("CylinderMesh_nxogm")
skeleton = NodePath("../../..")

[node name="gas" type="MeshInstance3D" parent="crankShaft/Cylinder4"]
transform = Transform3D(0.00371, 0, 0, 0, 1.81455, 0, 0, 0, 0.00371, 0, 2.87597, 0)
mesh = SubResource("CylinderMesh_nxogm")
skeleton = NodePath("../../..")
surface_material_override/0 = SubResource("ShaderMaterial_73fnb")

[node name="visuals" type="Node3D" parent="crankShaft/Cylinder4" node_paths=PackedStringArray("main", "gasInsideCylinder", "piston")]
script = ExtResource("4_m7jmp")
main = NodePath("..")
gasInsideCylinder = NodePath("../gas")
piston = NodePath("../pistone")

[node name="throttle" type="VSlider" parent="crankShaft"]
anchors_preset = 2
anchor_top = 1.0
anchor_bottom = 1.0
offset_top = -211.0
offset_right = 16.0
grow_vertical = 0
max_value = 1.0
step = 0.0

[node name="pressure" type="Label" parent="crankShaft"]
offset_top = 29.0
offset_right = 142.0
offset_bottom = 156.0
text = "Pressure :
0 
 0 
 0 
 0"

[node name="fps" type="Label" parent="crankShaft"]
offset_left = 986.0
offset_top = 26.0
offset_right = 1128.0
offset_bottom = 49.0
text = "FPS 25"

[node name="angular velocity" type="Label" parent="crankShaft"]
anchors_preset = 2
anchor_top = 1.0
anchor_bottom = 1.0
offset_left = 40.0
offset_top = -49.0
offset_right = 191.0
offset_bottom = -26.0
grow_vertical = 0
text = "Angular velocity: 1000"

[node name="torque" type="Label" parent="crankShaft"]
anchors_preset = 2
anchor_top = 1.0
anchor_bottom = 1.0
offset_left = 40.0
offset_top = -96.0
offset_right = 250.0
offset_bottom = -73.0
grow_vertical = 0
text = "torque: -2147483648"

[node name="rpm" type="Label" parent="crankShaft"]
anchors_preset = 2
anchor_top = 1.0
anchor_bottom = 1.0
offset_left = 38.0
offset_top = -131.0
offset_right = 180.0
offset_bottom = -108.0
grow_vertical = 0
text = "RPM: 167"

[node name="starter" type="CheckButton" parent="crankShaft"]
anchors_preset = 2
anchor_top = 1.0
anchor_bottom = 1.0
offset_left = 28.0
offset_top = -187.0
offset_right = 130.0
offset_bottom = -156.0
grow_vertical = 0
text = "Starter"

[node name="charts" type="Node" parent="crankShaft" node_paths=PackedStringArray("spawnPoint")]
script = ExtResource("3_xlvrw")
spawnPoint = NodePath("../chart SpaenPoint")
canvasScale = Vector2(0.1, 0.001)
pointScene = ExtResource("8_73fnb")
drawOffset = 2.0

[node name="chart SpaenPoint" type="Control" parent="crankShaft"]
layout_mode = 3
anchors_preset = 3
anchor_left = 1.0
anchor_top = 1.0
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = -433.0
offset_top = -267.0
grow_horizontal = 0
grow_vertical = 0

[node name="chassis" type="Node" parent="." node_paths=PackedStringArray("crankshaft", "gearText", "linearVelocityText", "dragText")]
script = ExtResource("9_5juve")
crankshaft = NodePath("../crankShaft")
mass = 6000.0
linearVelocity = 100.0
gearRatios = PackedFloat32Array(0.6, 1.2, 2, 2.5, 3, 3.5)
whealRadious = 0.15
dragModifeir = 6.0
dragBasedOnVelocity = SubResource("Curve_5juve")
gearText = NodePath("gear")
linearVelocityText = NodePath("velocity")
dragText = NodePath("drag force")

[node name="gear" type="Label" parent="chassis"]
anchors_preset = 3
anchor_left = 1.0
anchor_top = 1.0
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = -148.0
offset_top = -23.0
grow_horizontal = 0
grow_vertical = 0
text = "gear:"
vertical_alignment = 1

[node name="velocity" type="Label" parent="chassis"]
anchors_preset = 3
anchor_left = 1.0
anchor_top = 1.0
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = -148.0
offset_top = -41.0
offset_bottom = -18.0
grow_horizontal = 0
grow_vertical = 0
text = "velocity:"
vertical_alignment = 1

[node name="drag force" type="Label" parent="chassis"]
anchors_preset = 3
anchor_left = 1.0
anchor_top = 1.0
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = -148.0
offset_top = -59.0
offset_bottom = -36.0
grow_horizontal = 0
grow_vertical = 0
text = "drag force:"
vertical_alignment = 1

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.974173, 0.225801, 0, -0.225801, 0.974173, 0, 0, 0)

[node name="Camera3D" type="Camera3D" parent="."]
transform = Transform3D(-4.37114e-08, 0, 1, 0, 1, 0, -1, 0, -4.37114e-08, 50.4014, 23.9435, 26.5816)

[node name="Scene" parent="." instance=ExtResource("7_ni31j")]

[node name="Engine synth" parent="Scene" index="0"]
DistortionAmount = 9.595
FeedbackAmount = 9.84

[node name="AudioStreamPlayer" parent="Scene/Engine synth" index="0"]
volume_db = 1.0
pitch_scale = 0.00694444

[node name="LFO" parent="Scene" index="2"]
Rate = 0.0

[node name="Engine controller" parent="Scene" index="3"]
rpm = 166.667
volumeMinMax = Vector2(1, 10)

[editable path="Scene"]
